{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/editor.ts","src/elements/bg-editable.ts","src/elements/block.ts","src/elements/editable.ts","src/elements/file-upload.ts","src/elements/image.ts","src/elements/line.ts","src/elements/text.ts"],"names":[],"mappings":"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","file":"static-edit.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","import {Block} from './elements/block'\nimport {Line} from './elements/line'\nimport {Image} from './elements/image'\nimport {Editable} from './elements/editable'\nimport {BgEditable} from \"./elements/bg-editable\";\n\nexport type Options = {\n    saveButton: boolean,\n    selector: string,\n    bgSelector: string,\n}\n\nexport class Editor {\n    private editing: boolean\n    private elems: Editable[]\n    private selector: string = '.editable'\n    private bgSelector: string = '.bg-editable'\n\n    constructor(private options: Options) {\n        this.handleOptions()\n\n        this.elems = []\n\n        let elems: Array<Element> = Array.from(document.querySelectorAll(this.selector))\n        elems = elems.concat(Array.from(document.querySelectorAll(this.bgSelector)))\n\n        for (let i = 0; i < elems.length; ++i) {\n            let elm: Editable\n            let htmlElement: HTMLElement = <HTMLElement>elems[i];\n\n            if (htmlElement.matches(this.bgSelector)) {\n                elm = new BgEditable(htmlElement, this)\n            } else if (elems[i].tagName === 'P') {\n                elm = new Block(htmlElement, this)\n            } else if (elems[i].tagName === 'IMG') {\n                elm = new Image(htmlElement, this)\n            } else {\n                elm = new Line(htmlElement, this)\n            }\n\n            elm.bindEvents()\n            this.elems.push(elm)\n        }\n    }\n\n    handleOptions() {\n        if (this.options.saveButton === true) {\n            this.createSaveButton()\n        }\n\n        if (this.options.selector !== undefined) {\n            this.selector = this.options.selector\n        }\n    }\n\n    private createSaveButton() {\n        const button = document.createElement('button')\n        button.addEventListener('click', (e) => {\n            e.preventDefault()\n            e.stopPropagation()\n\n            window.dispatchEvent(\n                new CustomEvent('static_edit.saving', {detail: {changed: this.elems.filter((e) => e.hasChanged)}})\n            )\n        })\n\n        button.textContent = 'Save'\n        button.style.position = 'absolute'\n        button.style.top = '20px'\n        button.style.left = '20px'\n        document.body.appendChild(button)\n    }\n\n    editionStarted(elem: HTMLElement, oldValue: string) {\n        if (this.editing) {\n            return false\n        }\n\n        this.editing = true\n\n        window.dispatchEvent(new CustomEvent('static_edit.editing', {detail: {elem, oldValue}}))\n\n        return true\n    }\n\n    editionEnded(elem: HTMLElement, oldValue: string, newValue: string) {\n        this.editing = false\n\n        window.dispatchEvent(new CustomEvent('static_edit.edited', {detail: {elem, oldValue, newValue}}))\n    }\n}\n","import {FileUpload} from \"./file-upload\";\n\nexport class BgEditable extends FileUpload {\n\n    get value(): string {\n        return this.elem.style.backgroundImage\n    }\n\n    protected changeValue(value, name): void {\n        this.elem.dataset.fileName = name\n        this.elem.style.backgroundImage = `url(${value})`\n    }\n}","import {Text} from \"./text\";\n\nexport class Block extends Text {\n    createField(): HTMLInputElement {\n        return <any>document.createElement('textarea')\n    }\n}\n","import {Editor} from '../editor'\n\nexport abstract class Editable {\n    protected elem: HTMLElement\n    protected editor: Editor\n    protected changed: boolean\n\n    constructor(elem: HTMLElement, editor: Editor) {\n        this.elem = elem\n        this.editor = editor\n    }\n\n    abstract createField(): HTMLInputElement\n    abstract bindEvents(): void\n\n    get element(): HTMLElement {\n        return this.elem\n    }\n\n    get hasChanged(): boolean {\n        return this.changed\n    }\n}\n","import {Editable} from \"./editable\"\n\ninterface FileReaderEventTarget extends EventTarget {\n    result:string\n}\n\nexport abstract class FileUpload extends Editable {\n    abstract get value(): string\n    protected abstract changeValue(value, name): void\n\n    createField(): HTMLInputElement {\n        const input = document.createElement('input')\n\n        input.type = 'file'\n        input.style.display = 'none'\n\n        return input\n    }\n\n    bindEvents() {\n        this.elem.addEventListener('click', (e) => {\n            e.stopPropagation()\n            e.preventDefault()\n\n            const file = this.createField()\n            file.addEventListener('change', () => {\n                const uploadedFile = file.files[0]\n                if (!!uploadedFile.type.match(/image.*/)) {\n                    const reader = new FileReader()\n                    reader.addEventListener('loadend', (e: ProgressEvent) => {\n                        const newValue = (<FileReaderEventTarget>e.target).result\n                        const oldValue = this.value\n\n                        this.changeValue(newValue, uploadedFile.name)\n                        this.changed = true\n\n                        this.elem.parentNode.removeChild(file)\n\n                        setTimeout(() => this.editor.editionEnded(this.elem, oldValue, newValue), 100)\n                    })\n\n                    reader.readAsDataURL(uploadedFile)\n                }\n            })\n\n            this.elem.parentNode.appendChild(file)\n            file.click()\n        })\n    }\n}\n","import {FileUpload} from \"./file-upload\";\n\nexport class Image extends FileUpload {\n    elem: HTMLImageElement\n\n    get value(): string {\n        return this.elem.src\n    }\n\n    changeValue(value, name): void {\n        this.elem.src = value\n        this.elem.dataset.fileName = name\n    }\n}\n","import {Text} from \"./text\";\n\nexport class Line extends Text {\n    createField(): HTMLInputElement {\n        return document.createElement('input')\n    }\n}\n","import {Editable} from \"./editable\";\n\nexport abstract class Text extends Editable {\n    bindEvents() {\n        this.elem.addEventListener('click', (e) => {\n            e.stopPropagation()\n            e.preventDefault()\n            e.cancelBubble = true\n\n            if (!this.editor.editionStarted(this.elem, this.elem.innerText)) {\n                return false\n            }\n\n            const input = this.createField()\n            input.value = this.elem.innerText\n\n            input.addEventListener('blur', () => {\n                const oldValue = this.elem.innerText\n                const newValue = input.value\n\n                this.elem.innerText = newValue\n                this.changed = true\n                input.parentNode.replaceChild(this.elem, input)\n\n                // Make sure that no one triggers a new click on an editable while this is running\n                setTimeout(() => this.editor.editionEnded(this.elem, oldValue, newValue), 100)\n            })\n\n            input.addEventListener('click', (e) => {\n                e.stopPropagation()\n                e.preventDefault()\n            })\n\n            let resize = () => {\n                input.style.height = 'auto'\n                input.style.height = `${input.scrollHeight}px`\n            }\n\n            // Workaround for cut, paste, drop and keydown\n            let delayedResize = () => window.setTimeout(resize, 0)\n\n            input.addEventListener('change', resize)\n            input.addEventListener('cut', delayedResize)\n            input.addEventListener('paste', delayedResize)\n            input.addEventListener('drop', delayedResize)\n            input.addEventListener('keydown', delayedResize)\n\n            input.style.width = 'auto'\n            input.style.height = `${this.elem.offsetHeight}px`\n            input.style.overflowY = \"hidden\"\n            input.style.fontSize = window.getComputedStyle(this.elem).fontSize\n\n            this.elem.parentNode.replaceChild(input, this.elem)\n            input.focus()\n            resize()\n        }, true)\n    }\n\n    get value(): string {\n        return this.elem.textContent\n    }\n}"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvZWRpdG9yLnRzIiwic3JjL2VsZW1lbnRzL2JnLWVkaXRhYmxlLnRzIiwic3JjL2VsZW1lbnRzL2Jsb2NrLnRzIiwic3JjL2VsZW1lbnRzL2VkaXRhYmxlLnRzIiwic3JjL2VsZW1lbnRzL2ZpbGUtdXBsb2FkLnRzIiwic3JjL2VsZW1lbnRzL2ltYWdlLnRzIiwic3JjL2VsZW1lbnRzL2xpbmUudHMiLCJzcmMvZWxlbWVudHMvdGV4dC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7O0FDQUEsMENBQXNDO0FBQ3RDLHdDQUFvQztBQUNwQywwQ0FBc0M7QUFFdEMsc0RBQWtEO0FBUWxEO0lBTUksZ0JBQW9CLE9BQWdCO1FBQWhCLFlBQU8sR0FBUCxPQUFPLENBQVM7UUFINUIsYUFBUSxHQUFXLFdBQVcsQ0FBQTtRQUM5QixlQUFVLEdBQVcsY0FBYyxDQUFBO1FBR3ZDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQTtRQUVwQixJQUFJLENBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQTtRQUVmLElBQUksS0FBSyxHQUFtQixLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQTtRQUNoRixLQUFLLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBRTVFLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDO1lBQ3BDLElBQUksR0FBRyxTQUFVLENBQUE7WUFDakIsSUFBSSxXQUFXLEdBQTZCLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVyRCxFQUFFLENB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ZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCB7QmxvY2t9IGZyb20gJy4vZWxlbWVudHMvYmxvY2snXG5pbXBvcnQge0xpbmV9IGZyb20gJy4vZWxlbWVudHMvbGluZSdcbmltcG9ydCB7SW1hZ2V9IGZyb20gJy4vZWxlbWVudHMvaW1hZ2UnXG5pbXBvcnQge0VkaXRhYmxlfSBmcm9tICcuL2VsZW1lbnRzL2VkaXRhYmxlJ1xuaW1wb3J0IHtCZ0VkaXRhYmxlfSBmcm9tIFwiLi9lbGVtZW50cy9iZy1lZGl0YWJsZVwiO1xuXG5leHBvcnQgdHlwZSBPcHRpb25zID0ge1xuICAgIHNhdmVCdXR0b246IGJvb2xlYW4sXG4gICAgc2VsZWN0b3I6IHN0cmluZyxcbiAgICBiZ1NlbGVjdG9yOiBzdHJpbmcsXG59XG5cbmV4cG9ydCBjbGFzcyBFZGl0b3Ige1xuICAgIHByaXZhdGUgZWRpdGluZzogYm9vbGVhblxuICAgIHByaXZhdGUgZWxlbXM6IEVkaXRhYmxlW11cbiAgICBwcml2YXRlIHNlbGVjdG9yOiBzdHJpbmcgPSAnLmVkaXRhYmxlJ1xuICAgIHByaXZhdGUgYmdTZWxlY3Rvcjogc3RyaW5nID0gJy5iZy1lZGl0YWJsZSdcblxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgb3B0aW9uczogT3B0aW9ucykge1xuICAgICAgICB0aGlzLmhhbmRsZU9wdGlvbnMoKVxuXG4gICAgICAgIHRoaXMuZWxlbXMgPSBbXVxuXG4gICAgICAgIGxldCBlbGVtczogQXJyYXk8RWxlbWVudD4gPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwodGhpcy5zZWxlY3RvcikpXG4gICAgICAgIGVsZW1zID0gZWxlbXMuY29uY2F0KEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0aGlzLmJnU2VsZWN0b3IpKSlcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVsZW1zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBsZXQgZWxtOiBFZGl0YWJsZVxuICAgICAgICAgICAgbGV0IGh0bWxFbGVtZW50OiBIVE1MRWxlbWVudCA9IDxIVE1MRWxlbWVudD5lbGVtc1tpXTtcblxuICAgICAgICAgICAgaWYgKGh0bWxFbGVtZW50Lm1hdGNoZXModGhpcy5iZ1NlbGVjdG9yKSkge1xuICAgICAgICAgICAgICAgIGVsbSA9IG5ldyBCZ0VkaXRhYmxlKGh0bWxFbGVtZW50LCB0aGlzKVxuICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtc1tpXS50YWdOYW1lID09PSAnUCcpIHtcbiAgICAgICAgICAgICAgICBlbG0gPSBuZXcgQmxvY2soaHRtbEVsZW1lbnQsIHRoaXMpXG4gICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1zW2ldLnRhZ05hbWUgPT09ICdJTUcnKSB7XG4gICAgICAgICAgICAgICAgZWxtID0gbmV3IEltYWdlKGh0bWxFbGVtZW50LCB0aGlzKVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbG0gPSBuZXcgTGluZShodG1sRWxlbWVudCwgdGhpcylcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZWxtLmJpbmRFdmVudHMoKVxuICAgICAgICAgICAgdGhpcy5lbGVtcy5wdXNoKGVsbSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGhhbmRsZU9wdGlvbnMoKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2F2ZUJ1dHRvbiA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVTYXZlQnV0dG9uKClcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2VsZWN0b3IgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RvciA9IHRoaXMub3B0aW9ucy5zZWxlY3RvclxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjcmVhdGVTYXZlQnV0dG9uKCkge1xuICAgICAgICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKVxuICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG5cbiAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KFxuICAgICAgICAgICAgICAgIG5ldyBDdXN0b21FdmVudCgnc3RhdGljX2VkaXQuc2F2aW5nJywge2RldGFpbDoge2NoYW5nZWQ6IHRoaXMuZWxlbXMuZmlsdGVyKChlKSA9PiBlLmhhc0NoYW5nZWQpfX0pXG4gICAgICAgICAgICApXG4gICAgICAgIH0pXG5cbiAgICAgICAgYnV0dG9uLnRleHRDb250ZW50ID0gJ1NhdmUnXG4gICAgICAgIGJ1dHRvbi5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSdcbiAgICAgICAgYnV0dG9uLnN0eWxlLnRvcCA9ICcyMHB4J1xuICAgICAgICBidXR0b24uc3R5bGUubGVmdCA9ICcyMHB4J1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGJ1dHRvbilcbiAgICB9XG5cbiAgICBlZGl0aW9uU3RhcnRlZChlbGVtOiBIVE1MRWxlbWVudCwgb2xkVmFsdWU6IHN0cmluZykge1xuICAgICAgICBpZiAodGhpcy5lZGl0aW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2VcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZWRpdGluZyA9IHRydWVcblxuICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ3N0YXRpY19lZGl0LmVkaXRpbmcnLCB7ZGV0YWlsOiB7ZWxlbSwgb2xkVmFsdWV9fSkpXG5cbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG5cbiAgICBlZGl0aW9uRW5kZWQoZWxlbTogSFRNTEVsZW1lbnQsIG9sZFZhbHVlOiBzdHJpbmcsIG5ld1ZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5lZGl0aW5nID0gZmFsc2VcblxuICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ3N0YXRpY19lZGl0LmVkaXRlZCcsIHtkZXRhaWw6IHtlbGVtLCBvbGRWYWx1ZSwgbmV3VmFsdWV9fSkpXG4gICAgfVxufVxuIiwiaW1wb3J0IHtGaWxlVXBsb2FkfSBmcm9tIFwiLi9maWxlLXVwbG9hZFwiO1xuXG5leHBvcnQgY2xhc3MgQmdFZGl0YWJsZSBleHRlbmRzIEZpbGVVcGxvYWQge1xuXG4gICAgZ2V0IHZhbHVlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmVsZW0uc3R5bGUuYmFja2dyb3VuZEltYWdlXG4gICAgfVxuXG4gICAgcHJvdGVjdGVkIGNoYW5nZVZhbHVlKHZhbHVlLCBuYW1lKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWxlbS5kYXRhc2V0LmZpbGVOYW1lID0gbmFtZVxuICAgICAgICB0aGlzLmVsZW0uc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgke3ZhbHVlfSlgXG4gICAgfVxufSIsImltcG9ydCB7VGV4dH0gZnJvbSBcIi4vdGV4dFwiO1xuXG5leHBvcnQgY2xhc3MgQmxvY2sgZXh0ZW5kcyBUZXh0IHtcbiAgICBjcmVhdGVGaWVsZCgpOiBIVE1MSW5wdXRFbGVtZW50IHtcbiAgICAgICAgcmV0dXJuIDxhbnk+ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKVxuICAgIH1cbn1cbiIsImltcG9ydCB7RWRpdG9yfSBmcm9tICcuLi9lZGl0b3InXG5cbmV4cG9ydCBhYnN0cmFjdCBjbGFzcyBFZGl0YWJsZSB7XG4gICAgcHJvdGVjdGVkIGVsZW06IEhUTUxFbGVtZW50XG4gICAgcHJvdGVjdGVkIGVkaXRvcjogRWRpdG9yXG4gICAgcHJvdGVjdGVkIGNoYW5nZWQ6IGJvb2xlYW5cblxuICAgIGNvbnN0cnVjdG9yKGVsZW06IEhUTUxFbGVtZW50LCBlZGl0b3I6IEVkaXRvcikge1xuICAgICAgICB0aGlzLmVsZW0gPSBlbGVtXG4gICAgICAgIHRoaXMuZWRpdG9yID0gZWRpdG9yXG4gICAgfVxuXG4gICAgYWJzdHJhY3QgY3JlYXRlRmllbGQoKTogSFRNTElucHV0RWxlbWVudFxuICAgIGFic3RyYWN0IGJpbmRFdmVudHMoKTogdm9pZFxuXG4gICAgZ2V0IGVsZW1lbnQoKTogSFRNTEVsZW1lbnQge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtXG4gICAgfVxuXG4gICAgZ2V0IGhhc0NoYW5nZWQoKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiB0aGlzLmNoYW5nZWRcbiAgICB9XG59XG4iLCJpbXBvcnQge0VkaXRhYmxlfSBmcm9tIFwiLi9lZGl0YWJsZVwiXG5cbmludGVyZmFjZSBGaWxlUmVhZGVyRXZlbnRUYXJnZXQgZXh0ZW5kcyBFdmVudFRhcmdldCB7XG4gICAgcmVzdWx0OnN0cmluZ1xufVxuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgRmlsZVVwbG9hZCBleHRlbmRzIEVkaXRhYmxlIHtcbiAgICBhYnN0cmFjdCBnZXQgdmFsdWUoKTogc3RyaW5nXG4gICAgcHJvdGVjdGVkIGFic3RyYWN0IGNoYW5nZVZhbHVlKHZhbHVlLCBuYW1lKTogdm9pZFxuXG4gICAgY3JlYXRlRmllbGQoKTogSFRNTElucHV0RWxlbWVudCB7XG4gICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKVxuXG4gICAgICAgIGlucHV0LnR5cGUgPSAnZmlsZSdcbiAgICAgICAgaW5wdXQuc3R5bGUuZGlzcGxheSA9ICdub25lJ1xuXG4gICAgICAgIHJldHVybiBpbnB1dFxuICAgIH1cblxuICAgIGJpbmRFdmVudHMoKSB7XG4gICAgICAgIHRoaXMuZWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KClcblxuICAgICAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuY3JlYXRlRmllbGQoKVxuICAgICAgICAgICAgZmlsZS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdXBsb2FkZWRGaWxlID0gZmlsZS5maWxlc1swXVxuICAgICAgICAgICAgICAgIGlmICghIXVwbG9hZGVkRmlsZS50eXBlLm1hdGNoKC9pbWFnZS4qLykpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKVxuICAgICAgICAgICAgICAgICAgICByZWFkZXIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZGVuZCcsIChlOiBQcm9ncmVzc0V2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9ICg8RmlsZVJlYWRlckV2ZW50VGFyZ2V0PmUudGFyZ2V0KS5yZXN1bHRcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZFZhbHVlID0gdGhpcy52YWx1ZVxuXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZVZhbHVlKG5ld1ZhbHVlLCB1cGxvYWRlZEZpbGUubmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlZCA9IHRydWVcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5lbGVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZmlsZSlcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLmVkaXRvci5lZGl0aW9uRW5kZWQodGhpcy5lbGVtLCBvbGRWYWx1ZSwgbmV3VmFsdWUpLCAxMDApXG4gICAgICAgICAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgICAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwodXBsb2FkZWRGaWxlKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIHRoaXMuZWxlbS5wYXJlbnROb2RlLmFwcGVuZENoaWxkKGZpbGUpXG4gICAgICAgICAgICBmaWxlLmNsaWNrKClcbiAgICAgICAgfSlcbiAgICB9XG59XG4iLCJpbXBvcnQge0ZpbGVVcGxvYWR9IGZyb20gXCIuL2ZpbGUtdXBsb2FkXCI7XG5cbmV4cG9ydCBjbGFzcyBJbWFnZSBleHRlbmRzIEZpbGVVcGxvYWQge1xuICAgIGVsZW06IEhUTUxJbWFnZUVsZW1lbnRcblxuICAgIGdldCB2YWx1ZSgpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gdGhpcy5lbGVtLnNyY1xuICAgIH1cblxuICAgIGNoYW5nZVZhbHVlKHZhbHVlLCBuYW1lKTogdm9pZCB7XG4gICAgICAgIHRoaXMuZWxlbS5zcmMgPSB2YWx1ZVxuICAgICAgICB0aGlzLmVsZW0uZGF0YXNldC5maWxlTmFtZSA9IG5hbWVcbiAgICB9XG59XG4iLCJpbXBvcnQge1RleHR9IGZyb20gXCIuL3RleHRcIjtcblxuZXhwb3J0IGNsYXNzIExpbmUgZXh0ZW5kcyBUZXh0IHtcbiAgICBjcmVhdGVGaWVsZCgpOiBIVE1MSW5wdXRFbGVtZW50IHtcbiAgICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0JylcbiAgICB9XG59XG4iLCJpbXBvcnQge0VkaXRhYmxlfSBmcm9tIFwiLi9lZGl0YWJsZVwiO1xuXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgVGV4dCBleHRlbmRzIEVkaXRhYmxlIHtcbiAgICBiaW5kRXZlbnRzKCkge1xuICAgICAgICB0aGlzLmVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKVxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICBlLmNhbmNlbEJ1YmJsZSA9IHRydWVcblxuICAgICAgICAgICAgaWYgKCF0aGlzLmVkaXRvci5lZGl0aW9uU3RhcnRlZCh0aGlzLmVsZW0sIHRoaXMuZWxlbS5pbm5lclRleHQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGlucHV0ID0gdGhpcy5jcmVhdGVGaWVsZCgpXG4gICAgICAgICAgICBpbnB1dC52YWx1ZSA9IHRoaXMuZWxlbS5pbm5lclRleHRcblxuICAgICAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignYmx1cicsICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBvbGRWYWx1ZSA9IHRoaXMuZWxlbS5pbm5lclRleHRcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdWYWx1ZSA9IGlucHV0LnZhbHVlXG5cbiAgICAgICAgICAgICAgICB0aGlzLmVsZW0uaW5uZXJUZXh0ID0gbmV3VmFsdWVcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZWQgPSB0cnVlXG4gICAgICAgICAgICAgICAgaW5wdXQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQodGhpcy5lbGVtLCBpbnB1dClcblxuICAgICAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB0aGF0IG5vIG9uZSB0cmlnZ2VycyBhIG5ldyBjbGljayBvbiBhbiBlZGl0YWJsZSB3aGlsZSB0aGlzIGlzIHJ1bm5pbmdcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuZWRpdG9yLmVkaXRpb25FbmRlZCh0aGlzLmVsZW0sIG9sZFZhbHVlLCBuZXdWYWx1ZSksIDEwMClcbiAgICAgICAgICAgIH0pXG5cbiAgICAgICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBsZXQgcmVzaXplID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlucHV0LnN0eWxlLmhlaWdodCA9ICdhdXRvJ1xuICAgICAgICAgICAgICAgIGlucHV0LnN0eWxlLmhlaWdodCA9IGAke2lucHV0LnNjcm9sbEhlaWdodH1weGBcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gV29ya2Fyb3VuZCBmb3IgY3V0LCBwYXN0ZSwgZHJvcCBhbmQga2V5ZG93blxuICAgICAgICAgICAgbGV0IGRlbGF5ZWRSZXNpemUgPSAoKSA9PiB3aW5kb3cuc2V0VGltZW91dChyZXNpemUsIDApXG5cbiAgICAgICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIHJlc2l6ZSlcbiAgICAgICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2N1dCcsIGRlbGF5ZWRSZXNpemUpXG4gICAgICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdwYXN0ZScsIGRlbGF5ZWRSZXNpemUpXG4gICAgICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgZGVsYXllZFJlc2l6ZSlcbiAgICAgICAgICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBkZWxheWVkUmVzaXplKVxuXG4gICAgICAgICAgICBpbnB1dC5zdHlsZS53aWR0aCA9ICdhdXRvJ1xuICAgICAgICAgICAgaW5wdXQuc3R5bGUuaGVpZ2h0ID0gYCR7dGhpcy5lbGVtLm9mZnNldEhlaWdodH1weGBcbiAgICAgICAgICAgIGlucHV0LnN0eWxlLm92ZXJmbG93WSA9IFwiaGlkZGVuXCJcbiAgICAgICAgICAgIGlucHV0LnN0eWxlLmZvbnRTaXplID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUodGhpcy5lbGVtKS5mb250U2l6ZVxuXG4gICAgICAgICAgICB0aGlzLmVsZW0ucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQoaW5wdXQsIHRoaXMuZWxlbSlcbiAgICAgICAgICAgIGlucHV0LmZvY3VzKClcbiAgICAgICAgICAgIHJlc2l6ZSgpXG4gICAgICAgIH0sIHRydWUpXG4gICAgfVxuXG4gICAgZ2V0IHZhbHVlKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLmVsZW0udGV4dENvbnRlbnRcbiAgICB9XG59Il19"}